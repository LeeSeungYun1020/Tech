# Transaction
## 개요
- 데이터베이스 내에서 수행되는 작업의 최소 단위(하나 이상의 쿼리로 구성)
- 데이터베이스 무결성을 유지하며 상태를 변화시키는 기능 수행
- ACID: 원자성, 일관성, 고립성, 지속성 만족

## TIP
- 데이터베이스 단골 질문(index, transaction, deadlock) 중 하나
- 안전한 트랜잭션을 위한 원칙 4가지 - ACID 각 속성의 의미를 알아야

## 트랜잭션
- 은행 시스템에서 A가 B에게 1000원을 송금하는 경우
  - A의 계좌에서 1000원 출금
  - B의 계좌에 1000원 입금
  - 두 작업이 모두 성공해야 송금이 완료
  - A에게 출금했으나 B에게 입금되지 않은 경우 -> 데이터 부정합 - 전산시스템의 치명적 오류
  - 출금을 했으면 입금을 마치던지 또는 아예 없던 일이 되어야 함
  - 따라서 이러한 작업의 단위는 묶음으로 처리되어야 하는 단일 업무
  - 이러한 업무 처리의 최소 단위를 데이터베이스에서는 트랜잭션이라고 함
- 데이터베이스에서 트랜잭션이 필요한 이유는 데이터를 다루다 장애가 발생한 경우, 트랜잭션이 데이터를 복구하는 작업의 단위가 되기 때문
- 여러 작업이 동시에 같은 데이터를 다룰 경우, 트랜잭션으로 작업을 서로 분리하고 오류가 발생하지 않도록 함

## ACID
- 트랜잭션은 데이터베이스 무결성 유지를 위해 원자성, 일관성, 고립성, 지속성의 성질을 지님
- Atomicity(원자성): 트랜잭션에 포함된 작업은 전부 수행되거나 전부 수행되지 않아야(All or nothing)
- Consistency(일관성): 트랜잭션이 성공적으로 완료되면 데이터베이스는 일관성 있는 상태로 유지
- Isolation(고립성): 트랜잭션은 동시에 실행되는 다른 트랜잭션이 연산 작업에 끼어들지 못하도록 보장하여 독립적으로 작업 수행, 동시에 수행되는 트랜잭션이 동일한 데이터에서 충돌하지 않도록 제어(동시성 제어)
- Durability(지속성): 트랜잭션이 성공적으로 완료되면 결과는 영구적으로 반영되어야 함, 트랜잭션 완료 후 저장된 데이터는 정전, 장애, 기타 오류의 영향을 받지 않아야

## 동시성 제어
- 갱신 손실(갱신 작업 무효화): 여러 트랜잭션이 하나의 데이터를 동시에 업데이트하여 트랜잭션의 업데이트가 무효화 되는 것
- 동시성 제어를 통해 DBMS는 트랜잭션이 동시에 수행될 때, 데이터베이스 일관성을 해치지 않도록 트랜잭션의 데이터 접근을 제어
- Ex: 데이터를 수정 중인 트랜잭션이 데이터에 락을 걸어 다른 트랜잭션 차단(대기하도록 함)

## 커밋과 롤백
- 데이터베이스는 commit과 rollback 명령어로 데이터 무결성 보장
- commit: 트랜잭션의 작업이 성공적으로 완료되어 데이터베이스에 반영되는 것
- rollback: 트랜잭션의 작업이 비정상적으로 종료되어 데이터베이스에 반영되지 않는 것(변경 사항을 취소하고 이전 commit의 상태로 되돌림)

